{{ $page := .root }}
{{ $section := .page }}

<style>
    .carousel-item {
        min-height: 600px !important;
        max-height: 600px !important;
        display: flex !important;
        justify-content: center !important;
    }

    .carousel-indicators {
        top: 625px !important;
    }

    .carousel-indicators li {
        background-color: red;
    }

    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination-btn {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: 0.3s;
    }

    .pagination-btn:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    .pagination-btn:hover:not(:disabled) {
        background-color: #0056b3;
    }
</style>

<div id="carouselExampleIndicators" class="carousel slide">
    <div class="carousel-inner" id="carousel-inner"></div>
    <ol class="carousel-indicators" id="carousel-indicators"></ol>

    <div class="pagination-container">
        <button id="prevPage" class="pagination-btn">Previous</button>
        <button id="nextPage" class="pagination-btn">Next</button>
    </div>
</div>

<script async defer src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>

<script>
    let currentPage = 0;
    const itemsPerPage = 10;
    let totalPages = 0;
    let fbData = [];

    function readyCall() {
        var context = new XMLHttpRequest();
        context.responseType = 'json';
        context.open('GET', "/files/fbFeed.json", true);
        context.onreadystatechange = function () {
            if (context.readyState === 4 && context.status === 200) {
                fbData = this.response.data;
                if (!fbData || fbData.length === 0) {
                    console.error("No Facebook data available.");
                    return;
                }
                totalPages = Math.ceil(fbData.length / itemsPerPage);
                renderPage(currentPage);
            }
        };
        context.send();
    }

    function renderPage(page) {
        let start = page * itemsPerPage;
        let end = start + itemsPerPage;
        let pageData = fbData.slice(start, end);

        let carouselInner = document.getElementById("carousel-inner");
        let indicators = document.getElementById("carousel-indicators");

        carouselInner.innerHTML = ""; // Clear previous items
        indicators.innerHTML = "";

        pageData.forEach((post, index) => {
            let item = document.createElement("div");
            item.classList.add("carousel-item");
            if (index === 0) item.classList.add("active");

            let child = document.createElement("div");
            child.classList.add("fb-post");
            child.setAttribute("data-href", post);
            child.setAttribute("data-height", "600");
            child.setAttribute("data-width", "750");
            child.setAttribute("data-lazy", "true");

            item.appendChild(child);
            carouselInner.appendChild(item);

            let li = document.createElement("li");
            if (index === 0) li.classList.add("active");
            li.setAttribute("data-target", "#carouselExampleIndicators");
            li.setAttribute("data-slide-to", index);
            indicators.appendChild(li);
        });

        // Enable/disable buttons based on the current page
        document.getElementById("prevPage").disabled = page === 0;
        document.getElementById("nextPage").disabled = page >= totalPages - 1;
    }

    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 0) {
            currentPage--;
            renderPage(currentPage);
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        if (currentPage < totalPages - 1) {
            currentPage++;
            renderPage(currentPage);
        }
    });

    readyCall();
</script>
